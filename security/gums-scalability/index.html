<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>GUMS Scalability Case Study - OSG Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "GUMS Scalability Case Study";
    var mkdocs_page_input_path = "security/gums-scalability.md";
    var mkdocs_page_url = "/security/gums-scalability/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OSG Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../install-overview/">Installation Overview</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides - Common</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../common/ca/">CA Certificates</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common/yum/">Yum Repos</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides - Client</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../client/wn/">Worker Node (RPM install)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/wn-tarball/">Worker Node (tarball install)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/wn-oasis/">Worker Node (OASIS install)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/cvmfs/">CVMFS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/singularity/">Singularity</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides - Compute</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../compute-element/install-htcondor-ce/">HTCondor-CE</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides - Data</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../data/gridftp/">GridFTP Server</a>
                </li>
                <li class="">
                    
    <a class="" href="../../data/frontier-squid/">HTTP Cache</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides - Other</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../other/gsissh/">GSI-enabled SSH</a>
                </li>
                <li class="">
                    
    <a class="" href="../lcmaps-voms-authentication/">LCMAPS-VOMS authentication</a>
                </li>
                <li class="">
                    
    <a class="" href="../../other/install-osg-upcoming-software/">OSG upcoming software</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides - Monitoring</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../monitoring/rsv/">RSV</a>
                </li>
                <li class="">
                    
    <a class="" href="../../monitoring/rsv-gwms-tester/">RSV GlideinWMS Tester</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides - Other</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../other/gsissh/">GSI-enabled SSH</a>
                </li>
                <li class="">
                    
    <a class="" href="../lcmaps-voms-authentication/">LCMAPS-VOMS authentication</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Overviews</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../compute-element/htcondor-ce-overview/">HTCondor-CE</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Release Information</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../release/release_series/">OSG Release Series</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release/supported_platforms/">Supported Platforms</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release/yum-basics/">Yum Basics</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release/signing/">RPM Signing</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Usage Guides</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../common/pki-cli/">Certificate Tools</a>
                </li>
                <li class="">
                    
    <a class="" href="../../other/configuration-with-osg-configure/">Configuration with OSG-Configure</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/using-wn/">Worker Node Environment</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">In-Progress Docs</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../common/ca_updater/">CA Updater</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common/cert_scripts/">Certificate Request Scripts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../compute-element/job_router/">Job Router Recipe</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Deprecated Software</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../data/bestman-overview/">BeStMan Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../data/bestman-install/">BeStMan Install</a>
                </li>
                <li class="">
                    
    <a class="" href="../edg-mkgridmap/">EDG-Mkgridmap Install</a>
                </li>
                <li class="">
                    
    <a class="" href="../install-gums/">GUMS</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">GUMS Scalability Case Study</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#gums-scalability">GUMS Scalability</a></li>
    

    <li class="toctree-l3"><a href="#about-this-document">About this Document</a></li>
    

    <li class="toctree-l3"><a href="#background">Background</a></li>
    

    <li class="toctree-l3"><a href="#settings">Settings</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#gums-configuration-settings">GUMS configuration settings</a></li>
        
            <li><a class="toctree-l4" href="#tomcat-settings">Tomcat settings</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#system-level-settings">System level settings</a></li>
    

    <li class="toctree-l3"><a href="#references">References</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../client/glexec/">Worker node glexec Install</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../common/help/">Get Help</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OSG Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Deprecated Software &raquo;</li>
        
      
    
    <li>GUMS Scalability Case Study</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/docs/edit/master/docs/security/gums-scalability.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>GUMS is no longer be supported in OSG 3.4. The <a href="../../security/lcmaps-voms-authentication">LCMAPS VOMS Plugin</a> is the preferred method for site authentication in the OSG and is available in both OSG 3.3 and OSG 3.4.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These experiments were run on EL 5 machines. EL 5 is no longer supported as of OSG 3.3.</p>
</div>
<h1 id="gums-scalability">GUMS Scalability</h1>
<h1 id="about-this-document">About this Document</h1>
<p>The purpose of this document is to put together various GUMS configuration and system level settings that may help optimize GUMS server performance. It assumes you are familiar with GUMS, its installation and configuration as covered in <a href="../../security/install-gums">the GUMS install documentation</a>.</p>
<h1 id="background">Background</h1>
<p>In 2011, the FermiGrid Services group at Fermilab carried out various baseload/stress test runs against a locally deployed GUMS server.
The purpose of these tests were to tune settings in order to achieve a 100% success rate for all calls (both baseload jobs and stress run jobs) made to the GUMS server.
The GUMS server was named <code>gums1318.fnal.gov</code>.
This machine was actually a front end to two back end SL5 64bit servers, <code>gums1318a.fnal.gov</code> and <code>gums1318b.fnal.gov</code>, running GUMS 1.3.18.009-15.2.</p>
<p>Each baseload run involved 50 clients contacting the server in parallel.
The stress run, which was run on top of the baseload jobs, involved 5000 clients contacting the server in parallel,
each client making 100 calls in succession.
(That load was chosen to simulate the case of an active production system when someone deletes a large batch of jobs;
this would suddenly cause all jobs to run glExec to clean up.)
In addition to calls from baseload jobs, the stress run jobs provided a total of 500,000 calls to the GUMS server.</p>
<p>In 2015 the tests were repeated with GUMS 1.4.2-1.
We tested first with 5000 and then 8000 parallel clients, each running 100 queries in series.
The GUMS server was 16 cores, and the clients were running on 25 4-core FermiCloud VMs.
The average rate of service was 350 queries per second.</p>
<h1 id="settings">Settings</h1>
<p>We tuned the configuration in order to make the tests above successful.</p>
<h2 id="gums-configuration-settings">GUMS configuration settings</h2>
<p>In file <code>/etc/gums/gums.config</code>:</p>
<table>
<thead>
<tr>
<th><strong>Setting</strong></th>
<th><strong>Value</strong></th>
<th><strong>Comments</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hibernate.c3p0.timeout</code></td>
<td>300</td>
<td>number of seconds after which an idle connection is removed from connection pool</td>
</tr>
<tr>
<td><code>hibernate.c3p0.max_size</code></td>
<td>300</td>
<td>max number of db connections to keep in the connection pool</td>
</tr>
<tr>
<td><code>hibernate.c3p0.min_size</code></td>
<td>25</td>
<td>min number of ready db connections to keep in the connection pool</td>
</tr>
<tr>
<td><code>hibernate.c3p0.numHelperThreads</code></td>
<td>50</td>
<td>see note below; this setting isn't in the original template file from rpm, so it may need to be added in the config file</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The c3p0 library is very asynchronous. Slow JDBC operations are generally performed by helper threads that don't hold contended locks. Spreading these operations over multiple threads can significantly improve performance by allowing multiple operations to be performed simultaneously.</p>
</div>
<h2 id="tomcat-settings">Tomcat settings</h2>
<p>In file <code>/etc/tomcat5/server.xml</code> (<code>/etc/tomcat6/server.xml</code> on EL6), some of the following settings may not be in the original template file, just add them.</p>
<table>
<thead>
<tr>
<th><strong>Setting</strong></th>
<th><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>acceptCount</code></td>
<td>4096</td>
</tr>
</tbody>
</table>
<h1 id="system-level-settings">System level settings</h1>
<p>In file <code>/etc/sysctl.conf</code>, some settings may not present in the file and need to be added there. Then run <code>sysctl -p</code> to reload these new settings.</p>
<table>
<thead>
<tr>
<th align="left">Setting</th>
<th align="left">Value</th>
<th align="left">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>net.core.somaxconn</code></td>
<td align="left">4096</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<h1 id="references">References</h1>
<ul>
<li><a href="../../security/install-gums">GUMS Installation guide</a></li>
<li><a href="https://tomcat.apache.org/tomcat-5.5-doc">Official Tomcat 5 documentation</a></li>
<li><a href="https://tomcat.apache.org/tomcat-6.0-doc">Official Tomcat 6 documentation</a></li>
<li><a href="http://www.hibernate.org/docs">http://www.hibernate.org/docs</a> Official hibernate documentation</li>
<li><a href="http://www.mchange.com/projects/c3p0/">c3p0 documentation</a> and <a href="http://sourceforge.net/projects/c3p0/">code</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../client/glexec/" class="btn btn-neutral float-right" title="Worker node glexec Install">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../install-gums/" class="btn btn-neutral" title="GUMS"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/docs" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../install-gums/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../client/glexec/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
